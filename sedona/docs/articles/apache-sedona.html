<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="apache.sedona">
<title>Introduction to Apache Sedona for R â€¢ apache.sedona</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to Apache Sedona for R">
<meta property="og:description" content="apache.sedona">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">apache.sedona</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.3.1.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item">
  <a class="nav-link" href="../articles/apache-sedona.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/raster.html">Using raster data in Apache Sedona for R</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/apache/sedona/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Introduction to Apache Sedona for R</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/apache/sedona/blob/master/R/vignettes/apache-sedona.Rmd" class="external-link"><code>vignettes/apache-sedona.Rmd</code></a></small>
      <div class="d-none name"><code>apache-sedona.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p><a href="https://github.com/apache/sedona/" class="external-link">apache.sedona</a> is a <a href="https://spark.rstudio.com/" class="external-link">sparklyr</a>-based R
interface for <a href="https://sedona.apache.org" class="external-link">Apache Sedona</a>. It
presents what Apache Sedona has to offer through idiomatic frameworks
and constructs in R (e.g., one can build spatial Spark SQL queries using
Sedona UDFs in conjunction with a wide range of dplyr expressions),
hence making Apache Sedona highly friendly for R users.</p>
<p>Generally speaking, when working with Apache Sedona, one choose
between the following two modes:</p>
<ul>
<li>Manipulating Sedona <a href="../../tutorial/rdd">Spatial Resilient
Distributed Datasets</a> with spatial-RDD-related routines</li>
<li>Querying geometric columns within <a href="../../tutorial/sql">Spatial DataFrames</a> with Sedona spatial
UDFs</li>
</ul>
<p>While the former option enables more fine-grained control over
low-level implementation details (e.g., which index to build for spatial
queries, which data structure to use for spatial partitioning, etc), the
latter is simpler and leads to a straightforward integration with
<a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a>, <a href="https://spark.rstudio.com/" class="external-link">sparklyr</a>, and other
<a href="https://spark.rstudio.com/" class="external-link">sparklyr</a> extensions (e.g., one can build ML feature
extractors with Sedona UDFs and connect them with ML pipelines using
<code>ml_*()</code> family of functions in <a href="https://spark.rstudio.com/" class="external-link">sparklyr</a>,
hence creating ML workflows capable of understanding spatial data).</p>
<p>Because data from spatial RDDs can be imported into Spark DataFrames
as geometry columns and vice versa, one can switch between the
abovementioned two modes fairly easily.</p>
<p>At the moment <code>apache.sedona</code> consists of the following
components:</p>
<ul>
<li>R interface for Spatial-RDD-related functionalities
<ul>
<li>Reading/writing spatial data in WKT, WKB, and GeoJSON formats</li>
<li>Shapefile reader</li>
<li>Spatial partition, index, join, KNN query, and range query
operations</li>
<li>Visualization routines</li>
</ul>
</li>
<li>
<code>dplyr</code>-integration for Sedona spatial UDTs and UDFs
<ul>
<li>See <a href="../../api/sql/Overview/">SQL APIs</a> for the list of
available UDFs</li>
</ul>
</li>
<li>Functions importing data from spatial RDDs to Spark DataFrames and
vice versa</li>
</ul>
</div>
<div class="section level2">
<h2 id="connect-to-spark">Connect to Spark<a class="anchor" aria-label="anchor" href="#connect-to-spark"></a>
</h2>
<p>To ensure Sedona serialization routines, UDTs, and UDFs are properly
registered when creating a Spark session, one simply needs to attach
<code>apache.sedona</code> before instantiating a Spark connection.
apache.sedona will take care of the rest. For example,</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://spark.rstudio.com/" class="external-link">sparklyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/apache/sedona/" class="external-link">apache.sedona</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">spark_home</span> <span class="op">&lt;-</span> <span class="st">"/usr/lib/spark"</span>  <span class="co"># NOTE: replace this with your $SPARK_HOME directory</span></span>
<span><span class="va">sc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sparklyr/man/spark-connections.html" class="external-link">spark_connect</a></span><span class="op">(</span>master <span class="op">=</span> <span class="st">"yarn"</span>, spark_home <span class="op">=</span> <span class="va">spark_home</span><span class="op">)</span></span></code></pre></div>
<p>will create a Sedona-capable Spark connection in YARN client mode,
and</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://spark.rstudio.com/" class="external-link">sparklyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/apache/sedona/" class="external-link">apache.sedona</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">sc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sparklyr/man/spark-connections.html" class="external-link">spark_connect</a></span><span class="op">(</span>master <span class="op">=</span> <span class="st">"local"</span><span class="op">)</span></span></code></pre></div>
<p>will create a Sedona-capable Spark connection to an Apache Spark
instance running locally.</p>
<p>In <code>sparklyr</code>, one can easily inspect the Spark connection
object to sanity-check it has been properly initialized with all
Sedona-related dependencies, e.g.,</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">sc</span><span class="op">$</span><span class="va">extensions</span><span class="op">$</span><span class="va">packages</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "org.datasyslab:geotools-wrapper:1.4.0-28.2"</span></span>
<span><span class="co">#&gt; [2] "edu.ucar:cdm-core:5.4.2"</span></span></code></pre></div>
<p>and</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/sparklyr/man/spark-api.html" class="external-link">spark_session</a></span><span class="op">(</span><span class="va">sc</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/sparklyr/man/invoke.html" class="external-link">invoke</a></span><span class="op">(</span><span class="st">"%&gt;%"</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"conf"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"get"</span>, <span class="st">"spark.kryo.registrator"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "org.apache.sedona.viz.core.Serde.SedonaVizKryoRegistrator"</span></span></code></pre></div>
<p>For more information about connecting to Spark with
<code>sparklyr</code>, see <a href="https://therinspark.com/connections.html" class="external-link uri">https://therinspark.com/connections.html</a> and
<code><a href="https://rdrr.io/pkg/sparklyr/man/spark-connections.html" class="external-link">?sparklyr::spark_connect</a></code>. Also see <a href="../../tutorial/rdd/#initiate-sparkcontext">Initiate Spark
Context</a> and <a href="../../tutorial/sql/#initiate-sparksession">Initiate Spark
Session</a> for minimum and recommended dependencies for Apache
Sedona.</p>
</div>
<div class="section level2">
<h2 id="dplyr-workflows">dplyr workflows<a class="anchor" aria-label="anchor" href="#dplyr-workflows"></a>
</h2>
<p><code>apache.sedona</code> extends <code>sparklyr</code> integrates
with dplyr workflows. See the <a href="https://spark.rstudio.com/images/homepage/sparklyr.pdf" class="external-link">sparklyr
cheatsheet</a></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="loading-data">Loading data<a class="anchor" aria-label="anchor" href="#loading-data"></a>
</h3>
<div class="section level4">
<h4 id="copying-from-r">Copying from R<a class="anchor" aria-label="anchor" href="#copying-from-r"></a>
</h4>
<p>Data loaded in R can be copied to Spark using <code>copy_to</code>.
Columns containing spatial information can be converted to the geometry
type in Spark DataFrames (GeometryUDT) with Spark SQL functions such as
<code>ST_GeomFromText</code> or <code>ST_GeomFromText</code>, see <a href="https://sedona.apache.org/latest-snapshot/api/sql/Constructor/" class="external-link">Vector
constructors</a> and <a href="https://sedona.apache.org/latest-snapshot/api/sql/Raster-loader/" class="external-link">Raster
input and output</a>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_tsv</a></span><span class="op">(</span><span class="st">"../../binder/data/county_small.tsv"</span>, col_names <span class="op">=</span> <span class="cn">FALSE</span>, show_col_types <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 100</span></span>
<span><span class="co">#&gt; Columns: 18</span></span>
<span><span class="co">#&gt; $ X1  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "POLYGON ((-97.019516 42.004097,-97.019519 42.004933,-97.019527 42â€¦</span></span>
<span><span class="co">#&gt; $ X2  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "31", "53", "35", "31", "31", "72", "46", "48", "06", "21", "39", â€¦</span></span>
<span><span class="co">#&gt; $ X3  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "039", "069", "011", "109", "129", "085", "099", "327", "091", "05â€¦</span></span>
<span><span class="co">#&gt; $ X4  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "00835841", "01513275", "00933054", "00835876", "00835886", "01804â€¦</span></span>
<span><span class="co">#&gt; $ X5  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "31039", "53069", "35011", "31109", "31129", "72085", "46099", "48â€¦</span></span>
<span><span class="co">#&gt; $ X6  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Cuming", "Wahkiakum", "De Baca", "Lancaster", "Nuckolls", "Las Piâ€¦</span></span>
<span><span class="co">#&gt; $ X7  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Cuming County", "Wahkiakum County", "De Baca County", "Lancaster â€¦</span></span>
<span><span class="co">#&gt; $ X8  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "06", "06", "06", "06", "06", "13", "06", "06", "06", "06", "06", â€¦</span></span>
<span><span class="co">#&gt; $ X9  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "H1", "H1", "H1", "H1", "H1", "H1", "H1", "H1", "H1", "H1", "H1", â€¦</span></span>
<span><span class="co">#&gt; $ X10 <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "G4020", "G4020", "G4020", "G4020", "G4020", "G4020", "G4020", "G4â€¦</span></span>
<span><span class="co">#&gt; $ X11 <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> NA, NA, NA, 339, NA, 490, NA, NA, NA, NA, 248, NA, NA, 108, 338, Nâ€¦</span></span>
<span><span class="co">#&gt; $ X12 <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> NA, NA, NA, 30700, NA, 41980, 43620, NA, NA, NA, 22300, 38380, NA,â€¦</span></span>
<span><span class="co">#&gt; $ X13 <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NAâ€¦</span></span>
<span><span class="co">#&gt; $ X14 <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "A", "A", "A", "A", "A", "A", "A", "A", "A", "A", "A", "A", "A", "â€¦</span></span>
<span><span class="co">#&gt; $ X15 <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1477895811, 682138871, 6015539696, 2169240202, 1489645187, 8774836â€¦</span></span>
<span><span class="co">#&gt; $ X16 <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 10447360, 61658258, 29159492, 22877180, 1718484, 32509, 17349847, â€¦</span></span>
<span><span class="co">#&gt; $ X17 <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 41.91587, 46.29464, 34.35927, 40.78355, 40.17649, 18.18715, 43.667â€¦</span></span>
<span><span class="co">#&gt; $ X18 <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> -96.78852, -123.42446, -104.36870, -96.68866, -98.04684, -65.87119â€¦</span></span>
<span></span>
<span><span class="va">data_tbl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/copy_to.html" class="external-link">copy_to</a></span><span class="op">(</span><span class="va">sc</span>, <span class="va">data</span><span class="op">)</span></span>
<span></span>
<span><span class="va">data_tbl</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Source: spark&lt;data&gt; [?? x 18]</span></span></span>
<span><span class="co">#&gt;    X1    X2    X3    X4    X5    X6    X7    X8    X9    X10     X11   X12   X13</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> POLYâ€¦ 31    039   0083â€¦ 31039 Cumiâ€¦ Cumiâ€¦ 06    H1    G4020    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> POLYâ€¦ 53    069   0151â€¦ 53069 Wahkâ€¦ Wahkâ€¦ 06    H1    G4020    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> POLYâ€¦ 35    011   0093â€¦ 35011 De Bâ€¦ De Bâ€¦ 06    H1    G4020    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> POLYâ€¦ 31    109   0083â€¦ 31109 Lancâ€¦ Lancâ€¦ 06    H1    G4020   339 <span style="text-decoration: underline;">30</span>700    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> POLYâ€¦ 31    129   0083â€¦ 31129 Nuckâ€¦ Nuckâ€¦ 06    H1    G4020    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> POLYâ€¦ 72    085   0180â€¦ 72085 Las â€¦ Las â€¦ 13    H1    G4020   490 <span style="text-decoration: underline;">41</span>980    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> POLYâ€¦ 46    099   0126â€¦ 46099 Minnâ€¦ Minnâ€¦ 06    H1    G4020    <span style="color: #BB0000;">NA</span> <span style="text-decoration: underline;">43</span>620    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> POLYâ€¦ 48    327   0138â€¦ 48327 Menaâ€¦ Menaâ€¦ 06    H1    G4020    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> POLYâ€¦ 06    091   0027â€¦ 06091 Sierâ€¦ Sierâ€¦ 06    H1    G4020    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> POLYâ€¦ 21    053   0051â€¦ 21053 Clinâ€¦ Clinâ€¦ 06    H1    G4020    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># â€¦ with more rows, and 5 more variables: X14 &lt;chr&gt;, X15 &lt;dbl&gt;, X16 &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   X17 &lt;dbl&gt;, X18 &lt;dbl&gt;</span></span></span>
<span></span>
<span><span class="va">data_tbl</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/transmute.html" class="external-link">transmute</a></span><span class="op">(</span>geometry <span class="op">=</span> <span class="fu">st_geomfromtext</span><span class="op">(</span><span class="va">X1</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/sparklyr/man/sdf_schema.html" class="external-link">sdf_schema</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; $geometry</span></span>
<span><span class="co">#&gt; $geometry$name</span></span>
<span><span class="co">#&gt; [1] "geometry"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $geometry$type</span></span>
<span><span class="co">#&gt; [1] "GeometryUDT"</span></span></code></pre></div>
<p>No automatic translation of <a href="https://r-spatial.github.io/sf/" class="external-link">sf</a> objects is provided,
they need to be converted to text (or binary) format before copying to
spark.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="st">"../../binder/data/testPolygon.json"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Reading layer `testPolygon' from data source </span></span>
<span><span class="co">#&gt;   `/Users/gregoireleleu/WORK/MISC_CODE/sedona/binder/data/testPolygon.json' </span></span>
<span><span class="co">#&gt;   using driver `GeoJSON'</span></span>
<span><span class="co">#&gt; Simple feature collection with 1 feature and 10 fields</span></span>
<span><span class="co">#&gt; Geometry type: POLYGON</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: -87.62176 ymin: 34.83143 xmax: -87.60367 ymax: 34.87344</span></span>
<span><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span></span>
<span><span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 1</span></span>
<span><span class="co">#&gt; Columns: 11</span></span>
<span><span class="co">#&gt; $ STATEFP  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "01"</span></span>
<span><span class="co">#&gt; $ COUNTYFP <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "077"</span></span>
<span><span class="co">#&gt; $ TRACTCE  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "011501"</span></span>
<span><span class="co">#&gt; $ BLKGRPCE <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "5"</span></span>
<span><span class="co">#&gt; $ AFFGEOID <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "1500000US010770115015"</span></span>
<span><span class="co">#&gt; $ GEOID    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "010770115015"</span></span>
<span><span class="co">#&gt; $ NAME     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "5"</span></span>
<span><span class="co">#&gt; $ LSAD     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "BG"</span></span>
<span><span class="co">#&gt; $ ALAND    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 6844991</span></span>
<span><span class="co">#&gt; $ AWATER   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 32636</span></span>
<span><span class="co">#&gt; $ geometry <span style="color: #949494; font-style: italic;">&lt;POLYGON [Â°]&gt;</span> POLYGON ((-87.62176 34.8734...</span></span>
<span></span>
<span><span class="va">data_tbl</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/copy_to.html" class="external-link">copy_to</a></span><span class="op">(</span></span>
<span>    <span class="va">sc</span>, </span>
<span>    <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>geometry_wkb <span class="op">=</span> <span class="va">geometry</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_text.html" class="external-link">st_as_text</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  name <span class="op">=</span> <span class="st">"data"</span>,</span>
<span>  overwrite <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">data_tbl</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/transmute.html" class="external-link">transmute</a></span><span class="op">(</span>geometry <span class="op">=</span> <span class="fu">st_geomfromtext</span><span class="op">(</span><span class="va">geometry_wkb</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/sparklyr/man/sdf_schema.html" class="external-link">sdf_schema</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; $geometry</span></span>
<span><span class="co">#&gt; $geometry$name</span></span>
<span><span class="co">#&gt; [1] "geometry"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $geometry$type</span></span>
<span><span class="co">#&gt; [1] "GeometryUDT"</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="loading-directly-in-spark">Loading directly in Spark<a class="anchor" aria-label="anchor" href="#loading-directly-in-spark"></a>
</h4>
<p>Loading data in R and then copying it to Spark will most likely not
be the optimal method to prepare data for the analysis, and loading data
directly into Spark will often be best. The collection of
<code>spark_read_*</code> functions is made for this purpose (and extend
<code>spark_read_*</code> functions in <code>sparklyr</code>).</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_tbl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spark_read_shapefile.html">spark_read_geojson</a></span><span class="op">(</span><span class="va">sc</span>, path <span class="op">=</span> <span class="st">"../../binder/data/testPolygon.json"</span>, name <span class="op">=</span> <span class="st">"data"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">data_tbl</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: ??</span></span>
<span><span class="co">#&gt; Columns: 11</span></span>
<span><span class="co">#&gt; Database: spark_connection</span></span>
<span><span class="co">#&gt; $ geometry <span style="color: #949494; font-style: italic;">&lt;list&gt;</span> &lt;&lt;environment: 0x11e1ca0f0&gt;&gt;, &lt;&lt;environment: 0x11debb468&gt;&gt;, â€¦</span></span>
<span><span class="co">#&gt; $ STATEFP  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "01", "01", "01", "01", "01", "01", "01", "01", "01", "01", "â€¦</span></span>
<span><span class="co">#&gt; $ COUNTYFP <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "077", "045", "055", "089", "069", "073", "101", "015", "069"â€¦</span></span>
<span><span class="co">#&gt; $ TRACTCE  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "011501", "021102", "001300", "001700", "041400", "010801", "â€¦</span></span>
<span><span class="co">#&gt; $ BLKGRPCE <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "5", "4", "3", "2", "1", "4", "3", "1", "2", "3", "2", "4", "â€¦</span></span>
<span><span class="co">#&gt; $ AFFGEOID <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "1500000US010770115015", "1500000US010450211024", "1500000US0â€¦</span></span>
<span><span class="co">#&gt; $ GEOID    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "010770115015", "010450211024", "010550013003", "010890017002â€¦</span></span>
<span><span class="co">#&gt; $ NAME     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "5", "4", "3", "2", "1", "4", "3", "1", "2", "3", "2", "4", "â€¦</span></span>
<span><span class="co">#&gt; $ LSAD     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "BG", "BG", "BG", "BG", "BG", "BG", "BG", "BG", "BG", "BG", "â€¦</span></span>
<span><span class="co">#&gt; $ ALAND    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "6844991", "11360854", "1378742", "1040641", "8243574", "1303â€¦</span></span>
<span><span class="co">#&gt; $ AWATER   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "32636", "0", "247387", "0", "0", "9989", "0", "0", "159228",â€¦</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="manipulating">Manipulating<a class="anchor" aria-label="anchor" href="#manipulating"></a>
</h3>
<p>The dbplyr interface transparently translates dbplyr worklfows into
SQL, and gives access to all Apache Sedona SQL functions:</p>
<ul>
<li><a href="https://sedona.apache.org/latest-snapshot/api/sql/Function/" class="external-link">Vector
functions</a></li>
<li><a href="https://sedona.apache.org/latest-snapshot/api/sql/Predicate/" class="external-link">Vector
predicates</a></li>
<li><a href="https://sedona.apache.org/latest-snapshot/api/sql/AggregateFunction/" class="external-link">Vector
aggregate functions</a></li>
<li><a href="https://sedona.apache.org/latest-snapshot/api/sql/Raster-operators/" class="external-link">Raster
operators</a></li>
</ul>
<p>Results are then collected back into R with <code>collect</code>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## ! ST_FlipCoordinates needs to be called before st_transform as by default, this function uses lat/lon order</span></span>
<span><span class="va">data_tbl</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    ALAND <span class="op">=</span> <span class="va">ALAND</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    AWATER <span class="op">=</span> <span class="va">AWATER</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    area <span class="op">=</span> <span class="va">ALAND</span> <span class="op">+</span> <span class="va">AWATER</span>,</span>
<span>    geometry_proj <span class="op">=</span> <span class="fu">st_transform</span><span class="op">(</span><span class="fu">ST_FlipCoordinates</span><span class="op">(</span><span class="va">geometry</span><span class="op">)</span>, <span class="st">"epsg:4326"</span>, <span class="st">"epsg:5070"</span>, <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    area_geom <span class="op">=</span> <span class="fu">st_area</span><span class="op">(</span><span class="va">geometry_proj</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">STATEFP</span>, <span class="va">COUNTYFP</span>, <span class="va">area</span>, <span class="va">area_geom</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 Ã— 4</span></span></span>
<span><span class="co">#&gt;   STATEFP COUNTYFP     area area_geom</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 01      077       6<span style="text-decoration: underline;">877</span>627  6<span style="text-decoration: underline;">885</span>810.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 01      045      11<span style="text-decoration: underline;">360</span>854 11<span style="text-decoration: underline;">372</span>509.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 01      055       1<span style="text-decoration: underline;">626</span>129  1<span style="text-decoration: underline;">615</span>070.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 01      089       1<span style="text-decoration: underline;">040</span>641  1<span style="text-decoration: underline;">072</span>135.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 01      069       8<span style="text-decoration: underline;">243</span>574  8<span style="text-decoration: underline;">250</span>531.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 01      073       1<span style="text-decoration: underline;">313</span>587  1<span style="text-decoration: underline;">302</span>813.</span></span></code></pre></div>
<p>Geometries need to be converted to a serializable (text or binary)
format before <code>collect</code> is called:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Setting the CRS in R post-collect</span></span>
<span><span class="va">data_tbl</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    area <span class="op">=</span> <span class="fu">st_area</span><span class="op">(</span><span class="fu">st_transform</span><span class="op">(</span><span class="fu">ST_FlipCoordinates</span><span class="op">(</span><span class="va">geometry</span><span class="op">)</span>, <span class="st">"epsg:4326"</span>, <span class="st">"epsg:5070"</span>, <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    geometry_wkb <span class="op">=</span> <span class="va">geometry</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">st_asBinary</span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">COUNTYFP</span>, <span class="va">geometry_wkb</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span>crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span></span>
<span><span class="co">#&gt; Simple feature collection with 6 features and 1 field</span></span>
<span><span class="co">#&gt; Geometry type: POLYGON</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: -87.62176 ymin: 31.22179 xmax: -85.33003 ymax: 34.87344</span></span>
<span><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 Ã— 2</span></span></span>
<span><span class="co">#&gt;   COUNTYFP                                                          geometry_wkb</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">*</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                                            <span style="color: #949494; font-style: italic;">&lt;POLYGON [Â°]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 077      ((-87.62176 34.87344, -87.61754 34.87337, -87.6123 34.87334, -87.604â€¦</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 045      ((-85.71902 31.2979, -85.71563 31.3052, -85.71427 31.3071, -85.69999â€¦</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 055      ((-86.00069 34.00537, -85.99884 34.00977, -85.99801 34.0104, -85.987â€¦</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 089      ((-86.57417 34.72738, -86.56268 34.72713, -86.5628 34.72387, -86.562â€¦</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 069      ((-85.38287 31.23477, -85.37651 31.2347, -85.37143 31.23569, -85.365â€¦</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 073      ((-86.77326 33.49818, -86.77416 33.49972, -86.77005 33.50257, -86.77â€¦</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Setting the CRS in Spark (and using EWKT to keep it)</span></span>
<span><span class="va">data_tbl</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    area <span class="op">=</span> <span class="fu">st_area</span><span class="op">(</span><span class="fu">st_transform</span><span class="op">(</span><span class="fu">ST_FlipCoordinates</span><span class="op">(</span><span class="va">geometry</span><span class="op">)</span>, <span class="st">"epsg:4326"</span>, <span class="st">"epsg:5070"</span>, <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    geometry_ewkt <span class="op">=</span> <span class="va">geometry</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">st_setsrid</span><span class="op">(</span><span class="fl">4326</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">st_asewkt</span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">COUNTYFP</span>, <span class="va">geometry_ewkt</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span>wkt <span class="op">=</span> <span class="st">"geometry_ewkt"</span><span class="op">)</span> </span>
<span><span class="co">#&gt; Simple feature collection with 6 features and 1 field</span></span>
<span><span class="co">#&gt; Geometry type: POLYGON</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: -87.62176 ymin: 31.22179 xmax: -85.33003 ymax: 34.87344</span></span>
<span><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 Ã— 2</span></span></span>
<span><span class="co">#&gt;   COUNTYFP                                                         geometry_ewkt</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                                            <span style="color: #949494; font-style: italic;">&lt;POLYGON [Â°]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 077      ((-87.62176 34.87344, -87.61754 34.87337, -87.6123 34.87334, -87.604â€¦</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 045      ((-85.71902 31.2979, -85.71563 31.3052, -85.71427 31.3071, -85.69999â€¦</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 055      ((-86.00069 34.00537, -85.99884 34.00977, -85.99801 34.0104, -85.987â€¦</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 089      ((-86.57417 34.72738, -86.56268 34.72713, -86.5628 34.72387, -86.562â€¦</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 069      ((-85.38287 31.23477, -85.37651 31.2347, -85.37143 31.23569, -85.365â€¦</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 073      ((-86.77326 33.49818, -86.77416 33.49972, -86.77005 33.50257, -86.77â€¦</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="writing">Writing<a class="anchor" aria-label="anchor" href="#writing"></a>
</h3>
<p>Collected results can be saved directly in R. In many cases it will
be more efficient to write results directly from Spark. The
<code>spark_write_*</code> (see <a href="apache.sedona::spark_write_geojson">docs</a>) functions are made
for this purpose (and extend <code>spark_write_*</code> functions in
<code>sparklyr</code>).</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dest_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="op">)</span> <span class="co">## Destination folder</span></span>
<span><span class="va">data_tbl</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu">str_sub</span><span class="op">(</span><span class="va">COUNTYFP</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span> <span class="op">==</span> <span class="st">"00"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/spark_write_geojson.html">spark_write_geoparquet</a></span><span class="op">(</span>path <span class="op">=</span> <span class="va">dest_file</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dest_file</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">dir</a></span><span class="op">(</span>recursive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "_SUCCESS"                                                           </span></span>
<span><span class="co">#&gt; [2] "part-00000-8eea1db8-d140-41c1-ac76-1aa13f2b49c9-c000.snappy.parquet"</span></span></code></pre></div>
<p>The output can be partitioned by the columns present in the data:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dest_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="op">)</span>  <span class="co">## Destination folder</span></span>
<span><span class="va">data_tbl</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu">str_sub</span><span class="op">(</span><span class="va">COUNTYFP</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span> <span class="op">==</span> <span class="st">"00"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/spark_write_geojson.html">spark_write_geoparquet</a></span><span class="op">(</span>path <span class="op">=</span> <span class="va">dest_file</span>, partition_by <span class="op">=</span> <span class="st">"COUNTYFP"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dest_file</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">dir</a></span><span class="op">(</span>recursive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "_SUCCESS"                                                                        </span></span>
<span><span class="co">#&gt; [2] "COUNTYFP=001/part-00000-3033294e-0bad-40cf-a7cc-5e56030a3b04.c000.snappy.parquet"</span></span>
<span><span class="co">#&gt; [3] "COUNTYFP=003/part-00000-3033294e-0bad-40cf-a7cc-5e56030a3b04.c000.snappy.parquet"</span></span>
<span><span class="co">#&gt; [4] "COUNTYFP=005/part-00000-3033294e-0bad-40cf-a7cc-5e56030a3b04.c000.snappy.parquet"</span></span>
<span><span class="co">#&gt; [5] "COUNTYFP=007/part-00000-3033294e-0bad-40cf-a7cc-5e56030a3b04.c000.snappy.parquet"</span></span>
<span><span class="co">#&gt; [6] "COUNTYFP=009/part-00000-3033294e-0bad-40cf-a7cc-5e56030a3b04.c000.snappy.parquet"</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="spark-dataframes">Spark DataFrames<a class="anchor" aria-label="anchor" href="#spark-dataframes"></a>
</h3>
<p><a href="https://spark.apache.org/docs/latest/sql-programming-guide.html" class="external-link">Spark
DataFrames</a> provide a higher level API than RDDs, and can be used
with SQL queries. <code>sparklyr</code> and <code>apache.sedona</code>
automatically wrap Spark DataFrames in <code>dplyr</code>
<code>tbl</code>s to work in dplyr workflows.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_tbl</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "tbl_spark" "tbl_sql"   "tbl_lazy"  "tbl"</span></span></code></pre></div>
<p>You can get to the underlying Spark DataFrame (SDF) with
<code><a href="https://rdrr.io/pkg/sparklyr/man/spark_dataframe.html" class="external-link">sparklyr::spark_dataframe</a></code></p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sdf</span> <span class="op">&lt;-</span> <span class="va">data_tbl</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/pkg/sparklyr/man/spark_dataframe.html" class="external-link">spark_dataframe</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">sdf</span></span>
<span><span class="co">#&gt; &lt;jobj[161]&gt;</span></span>
<span><span class="co">#&gt;   org.apache.spark.sql.Dataset</span></span>
<span><span class="co">#&gt;   [geometry: geometry, STATEFP: string ... 9 more fields]</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="rdd-workflows">RDD workflows<a class="anchor" aria-label="anchor" href="#rdd-workflows"></a>
</h2>
<div class="section level3">
<h3 id="what-are-spatialrdds">What are <code>SpatialRDD</code>s?<a class="anchor" aria-label="anchor" href="#what-are-spatialrdds"></a>
</h3>
<p><a href="https://sedona.apache.org/latest-snapshot/tutorial/rdd/" class="external-link">SpatialRDDs</a>
are basic building blocks of distributed spatial data in Apache Sedona.
A <code>SpatialRDD</code> can be partitioned and indexed using
well-known spatial data structures to facilitate range queries, KNN
queries, and other low-level operations. One can also export records
from <code>SpatialRDD</code>s into regular Spark DataFrames, making them
accessible through Spark SQL and through the <code>dplyr</code>
interface of <code>sparklyr</code>.</p>
</div>
<div class="section level3">
<h3 id="creating-a-spatialrdd">Creating a SpatialRDD<a class="anchor" aria-label="anchor" href="#creating-a-spatialrdd"></a>
</h3>
<p>NOTE: this section is largely based on <a href="../rdd/#create-a-spatialrdd">Spatial RDD Scala tutorial</a>,
except for examples have been written in R instead of Scala to reflect
usages of <code>apache.sedona</code>.</p>
<p>Currently <code>SpatialRDD</code>s can be created in
<code>apache.sedona</code> by reading a file in a supported geospatial
format (<code>sedona_read_*</code> functions), or by extracting data
from a Spark SQL query.</p>
<p>For example, the following code will import data from <a href="https://github.com/apache/sedona/blob/master/binder/data/arealm-small.csv" class="external-link">arealm-small.csv</a>
into a <code>SpatialRDD</code>:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pt_rdd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sedona_read_dsv_to_typed_rdd.html">sedona_read_dsv_to_typed_rdd</a></span><span class="op">(</span></span>
<span>  <span class="va">sc</span>,</span>
<span>  location <span class="op">=</span> <span class="st">"../../binder/data/arealm-small.csv"</span>,</span>
<span>  delimiter <span class="op">=</span> <span class="st">","</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"point"</span>,</span>
<span>  first_spatial_col_index <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  has_non_spatial_attrs <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Records from the example <a href="https://github.com/apache/sedona/blob/master/binder/data/arealm-small.csv" class="external-link">arealm-small.csv</a>
file look like the following:</p>
<pre><code>testattribute0,-88.331492,32.324142,testattribute1,testattribute2
testattribute0,-88.175933,32.360763,testattribute1,testattribute2
testattribute0,-88.388954,32.357073,testattribute1,testattribute2</code></pre>
<p>As one can see from the above, each record is comma-separated and
consists of a 2-dimensional coordinate starting at the 2nd column and
ending at the 3rd column. All other columns contain non-spatial
attributes. Because column indexes are 0-based, we need to specify
<code>first_spatial_col_index = 1</code> in the example above to ensure
each record is parsed correctly.</p>
<p>In addition to formats such as CSV and TSV, currently
<code>apache.sedona</code> also supports reading files in WKT
(Well-Known Text), WKB (Well-Known Binary), Shapefile and GeoJSON
formats. See <code>sedona_read_wkt</code> for details.</p>
</div>
<div class="section level3">
<h3 id="conversion-to-and-from-spatialrdd">Conversion to and from SpatialRDD<a class="anchor" aria-label="anchor" href="#conversion-to-and-from-spatialrdd"></a>
</h3>
<p>One can also run <code><a href="../reference/to_spatial_rdd.html">to_spatial_rdd()</a></code> to extract a
SpatialRDD from a Spark SQL query, e.g.Â the query below will extract a
spatial column named <code>"geom"</code> from the Sedona spatial SQL
query above and store it in a <code>SpatialRDD</code> object.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">sdf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/tbl.html" class="external-link">tbl</a></span><span class="op">(</span></span>
<span>  <span class="va">sc</span>,</span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/sql.html" class="external-link">sql</a></span><span class="op">(</span><span class="st">"SELECT ST_GeomFromText('POINT(-71.064544 42.28787)') AS `geom`, \"point\" AS `type`"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">spatial_rdd</span> <span class="op">&lt;-</span> <span class="va">sdf</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/to_spatial_rdd.html">to_spatial_rdd</a></span><span class="op">(</span>spatial_col <span class="op">=</span> <span class="st">"geom"</span><span class="op">)</span></span>
<span><span class="va">spatial_rdd</span></span>
<span><span class="co">#&gt; $.jobj</span></span>
<span><span class="co">#&gt; &lt;jobj[169]&gt;</span></span>
<span><span class="co">#&gt;   org.apache.sedona.core.spatialRDD.SpatialRDD</span></span>
<span><span class="co">#&gt;   org.apache.sedona.core.spatialRDD.SpatialRDD@13d814f</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $.state</span></span>
<span><span class="co">#&gt; &lt;environment: 0x12d5d5340&gt;</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attr(,"class")</span></span>
<span><span class="co">#&gt; [1] "spatial_rdd"</span></span></code></pre></div>
<p>A <code>SpatialRDD</code> can be converted into a Spark DataFrame
with <code>sdf_register</code> (generic method from
<code>sparklyr</code>).</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spatial_sdf</span> <span class="op">&lt;-</span> <span class="va">spatial_rdd</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/pkg/sparklyr/man/sdf_register.html" class="external-link">sdf_register</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"my_table"</span><span class="op">)</span></span>
<span><span class="va">spatial_sdf</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Source: spark&lt;my_table&gt; [?? x 2]</span></span></span>
<span><span class="co">#&gt;   geometry                      type </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>                        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> <span style="color: #949494;">&lt;POINT (-71.064544 42.28787)&gt;</span> point</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="visualization">Visualization<a class="anchor" aria-label="anchor" href="#visualization"></a>
</h2>
<p>An important part of <code>apache.sedona</code> is its collection of
R interfaces to Sedona visualization routines. For example, the
following is essentially the R equivalent of <a href="https://github.com/apache/sedona/blob/f6b1c5e24bdb67d2c8d701a9b2af1fb5658fdc4d/viz/src/main/scala/org/apache/sedona/viz/showcase/ScalaExample.scala#L142-L160" class="external-link">this
example in Scala</a>.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">resolution_x</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span><span class="va">resolution_y</span> <span class="op">&lt;-</span> <span class="fl">600</span></span>
<span><span class="va">boundary</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">126.790180</span>, <span class="op">-</span><span class="fl">64.630926</span>, <span class="fl">24.863836</span>, <span class="fl">50.000</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pt_rdd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sedona_read_dsv_to_typed_rdd.html">sedona_read_dsv_to_typed_rdd</a></span><span class="op">(</span></span>
<span>  <span class="va">sc</span>,</span>
<span>  location <span class="op">=</span> <span class="st">"../../core/src/test/resources/arealm.csv"</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"point"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">polygon_rdd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sedona_read_dsv_to_typed_rdd.html">sedona_read_dsv_to_typed_rdd</a></span><span class="op">(</span></span>
<span>  <span class="va">sc</span>,</span>
<span>  location <span class="op">=</span> <span class="st">"../../core/src/test/resources/primaryroads-polygon.csv"</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"polygon"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">pair_rdd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sedona_spatial_join_count_by_key.html">sedona_spatial_join_count_by_key</a></span><span class="op">(</span></span>
<span>  <span class="va">pt_rdd</span>,</span>
<span>  <span class="va">polygon_rdd</span>,</span>
<span>  join_type <span class="op">=</span> <span class="st">"intersect"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">overlay</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sedona_render_scatter_plot.html">sedona_render_scatter_plot</a></span><span class="op">(</span></span>
<span>  <span class="va">polygon_rdd</span>,</span>
<span>  <span class="va">resolution_x</span>,</span>
<span>  <span class="va">resolution_y</span>,</span>
<span>  output_location <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="st">"scatter-plot-"</span><span class="op">)</span>,</span>
<span>  boundary <span class="op">=</span> <span class="va">boundary</span>,</span>
<span>  base_color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">255</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>  browse <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/sedona_render_choropleth_map.html">sedona_render_choropleth_map</a></span><span class="op">(</span></span>
<span>  <span class="va">pair_rdd</span>,</span>
<span>  <span class="va">resolution_x</span>,</span>
<span>  <span class="va">resolution_y</span>,</span>
<span>  output_location <span class="op">=</span> <span class="st">"./choropleth-map"</span>,</span>
<span>  boundary <span class="op">=</span> <span class="va">boundary</span>,</span>
<span>  overlay <span class="op">=</span> <span class="va">overlay</span>,</span>
<span>  <span class="co"># vary the green color channel according to relative magnitudes of data points so</span></span>
<span>  <span class="co"># that the resulting map will show light blue, light purple, and light gray pixels</span></span>
<span>  color_of_variation <span class="op">=</span> <span class="st">"green"</span>,</span>
<span>  base_color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">225</span>, <span class="fl">225</span>, <span class="fl">255</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>It will create a scatter plot, and then overlay it on top of a
choropleth map, as shown below:</p>
<p><img src="choropleth-map.png" width="800"></p>
<p>See <code><a href="../reference/sedona_render_scatter_plot.html">?apache.sedona::sedona_render_scatter_plot</a></code>,
<code><a href="../reference/sedona_render_heatmap.html">?apache.sedona::sedona_render_heatmap</a></code>, and
<code><a href="../reference/sedona_render_choropleth_map.html">?apache.sedona::sedona_render_choropleth_map</a></code> for more
details on visualization-related R interfaces currently implemented by
<code>apache.sedona</code>.</p>
</div>
<div class="section level2">
<h2 id="advanced-parameters">Advanced parameters<a class="anchor" aria-label="anchor" href="#advanced-parameters"></a>
</h2>
<p>Various advanced parameters can be set in Apache Sedona, see <a href="https://sedona.apache.org/latest-snapshot/api/sql/Parameter/" class="external-link">parameters</a></p>
<p>Through the sparklyr config:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">config</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sparklyr/man/spark_config.html" class="external-link">spark_config</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">config</span><span class="op">[[</span><span class="st">"sedona.global.index"</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">FALSE</span></span>
<span></span>
<span><span class="va">sc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sparklyr/man/spark-connections.html" class="external-link">spark_connect</a></span><span class="op">(</span>master <span class="op">=</span> <span class="st">"local"</span>, config <span class="op">=</span> <span class="va">config</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â„¹</span> Using Sedona jars listed in SEDONA_JAR_FILES variable (see Sys.getenv("SEDONA_JAR_FILES"))</span></span></code></pre></div>
<p>Check</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/sparklyr/man/invoke.html" class="external-link">invoke_new</a></span><span class="op">(</span><span class="va">sc</span>, <span class="st">"org.apache.sedona.core.utils.SedonaConf"</span>, <span class="fu"><a href="https://rdrr.io/pkg/sparklyr/man/invoke.html" class="external-link">invoke</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/sparklyr/man/spark-api.html" class="external-link">spark_session</a></span><span class="op">(</span><span class="va">sc</span><span class="op">)</span>, <span class="st">"conf"</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="co">#&gt; &lt;jobj[53]&gt;</span></span>
<span><span class="co">#&gt;   org.apache.sedona.core.utils.SedonaConf</span></span>
<span><span class="co">#&gt;   Sedona Configuration:</span></span>
<span><span class="co">#&gt; useIndex: true</span></span>
<span><span class="co">#&gt; indexType: QUADTREE</span></span>
<span><span class="co">#&gt; joinSparitionDominantSide: LEFT</span></span>
<span><span class="co">#&gt; joinBuildSide: LEFT</span></span>
<span><span class="co">#&gt; joinApproximateTotalCount: -1</span></span>
<span><span class="co">#&gt; datasetBoundary: Env[0.0 : 0.0, 0.0 : 0.0]</span></span>
<span><span class="co">#&gt; fallbackPartitionNum: -1</span></span>
<span><span class="co">#&gt; joinGridType: KDBTREE</span></span>
<span><span class="co">#&gt; autoBroadcastJoinThreshold: 10485760</span></span></code></pre></div>
<p>Or change at runtime:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/sparklyr/man/spark-api.html" class="external-link">spark_session</a></span><span class="op">(</span><span class="va">sc</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/sparklyr/man/invoke.html" class="external-link">invoke</a></span><span class="op">(</span><span class="st">"conf"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/sparklyr/man/invoke.html" class="external-link">invoke</a></span><span class="op">(</span><span class="st">"set"</span>, <span class="st">"sedona.global.index"</span>,<span class="st">"true"</span><span class="op">)</span></span>
<span><span class="co">#&gt; NULL</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/sparklyr/man/invoke.html" class="external-link">invoke_new</a></span><span class="op">(</span><span class="va">sc</span>, <span class="st">"org.apache.sedona.core.utils.SedonaConf"</span>, <span class="fu"><a href="https://rdrr.io/pkg/sparklyr/man/invoke.html" class="external-link">invoke</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/sparklyr/man/spark-api.html" class="external-link">spark_session</a></span><span class="op">(</span><span class="va">sc</span><span class="op">)</span>, <span class="st">"conf"</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="co">#&gt; &lt;jobj[57]&gt;</span></span>
<span><span class="co">#&gt;   org.apache.sedona.core.utils.SedonaConf</span></span>
<span><span class="co">#&gt;   Sedona Configuration:</span></span>
<span><span class="co">#&gt; useIndex: true</span></span>
<span><span class="co">#&gt; indexType: QUADTREE</span></span>
<span><span class="co">#&gt; joinSparitionDominantSide: LEFT</span></span>
<span><span class="co">#&gt; joinBuildSide: LEFT</span></span>
<span><span class="co">#&gt; joinApproximateTotalCount: -1</span></span>
<span><span class="co">#&gt; datasetBoundary: Env[0.0 : 0.0, 0.0 : 0.0]</span></span>
<span><span class="co">#&gt; fallbackPartitionNum: -1</span></span>
<span><span class="co">#&gt; joinGridType: KDBTREE</span></span>
<span><span class="co">#&gt; autoBroadcastJoinThreshold: 10485760</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Apache Sedona, Yitao Li.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
